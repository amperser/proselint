<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Proselint</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main>
      <h1>Proselint</h1>
      <p>
        <em>Proselint</em> is a linter for English prose. It highlights
        <em>clich√©s</em>, <em>jargon</em>, <em>illogical phrasing</em>, and
        other stylistic issues, much like a spellchecker for style. <br />
        <br />

        You can navigate the available <a href="rules.html">rules</a> or get
        further <a href="help.html">help</a>.
      </p>

      <h2>Install</h2>
      <p>
        Install via <em>pip</em> and try a quick example from the command line.
      </p>
      <div>
        <pre title="Click to copy">
<code><span class="blue">pip</span> <span class="purple">install</span> <span class="green">proselint</span></code>
</pre>
        <pre title="Click to copy">
<code><span class="blue">echo</span> <span class="green">"This is very unique and literally perfect."</span> <span class="red">|</span> <span class="blue">proselint</span> <span class="purple">check</span>
<span class="blue">proselint</span> <span class="purple">check</span> <span class="amber">README.md</span></code>
</pre>
      </div>
      <h2>Try it</h2>
      <p>Paste or type some text below.</p>
      <div>
        <textarea id="input" rows="8">
This is very unique and literally perfect.</textarea
        >
      </div>

      <h3>Issues</h3>
      <ul id="issues">
        <li>
          <em>uncomparables</em> Comparison of an uncomparable: 'very unique' is
          not comparable.
        </li>
        <li>
          <em>weasel_words.very</em> Substitute 'damn' every time you're
          inclined to write 'very'; your editor will delete it and the writing
          will be just as it should be.
        </li>
      </ul>
    </main>

    <%- include('partials/footer.ejs') %>

    <script>
      const input = document.getElementById("input");
      const issues = document.getElementById("issues");
      const baseApiURL = "<%= apiURL %>";

      function debounce(fn, delay) {
        let timer;

        return function (...args) {
          clearTimeout(timer);
          timer = setTimeout(() => fn.apply(this, args), delay);
        };
      }

      async function check() {
        if (input.value.trim() === "") {
          issues.innerHTML = "<li>No issues found.</li>";
          return;
        }

        const res = await fetch(`${baseApiURL}/v1`, {
          method: "POST",
          headers: { "Content-Type": "text/plain" },
          body: input.value,
        });

        const json = await res.json();

        if (json.status !== "success") {
          issues.innerHTML = `<li>Couldn't check, ${json.message}.</li>`;
          return;
        }

        if (json.data.length === 0) {
          issues.innerHTML = "<li>No issues found.</li>";
          return;
        }

        issues.innerHTML = "";

        for (const issue of json.data) {
          const li = document.createElement("li");
          li.innerHTML = `<em>${issue.check_path}</em> ${issue.message}`;
          issues.appendChild(li);
        }
      }

      input.addEventListener("input", debounce(check, 300));
    </script>
  </body>
</html>
